{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/estilo_cubo.css') }}">

<div class="main-container">
    <h1 class="titulo-principal">丘덢잺 Tablero de Mando Cl칤nico 丘덢잺</h1>
    
    <div class="kpi-grid">
        <div class="kpi-card gold">
            <h3>游눯 Ingresos Totales</h3>
            <p class="kpi-value">${{ total_ingresos }}</p>
        </div>

        <div class="kpi-card blue">
            <h3>游논 Pacientes Activos</h3>
            <p class="kpi-value">{{ total_pacientes }}</p>
        </div>

        <div class="kpi-card green">
            <h3>游닆 Citas Realizadas</h3>
            <p class="kpi-value">{{ total_citas }}</p>
        </div>
        
        <div class="kpi-card red">
            <h3>staff M칠dico</h3>
            <p class="kpi-value">{{ total_medicos }}</p>
        </div>
    </div>

    <div class="charts-grid">
        
        <div class="chart-container-box">
            <h2>游늳 Afluencia Mensual</h2>
            <div style="position: relative; height: 300px; width: 100%;">
                <canvas id="graficoBarras"></canvas>
            </div>
        </div>

        <div class="chart-container-box">
            <h2>游꼻 Especialidades Demandadas</h2>
            <div style="position: relative; height: 300px; width: 100%;">
                <canvas id="graficoPastel"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Configuraci칩n para que NO se desborde
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
    };

    // 1. Gr치fico de Barras
    new Chart(document.getElementById('graficoBarras'), {
        type: 'bar',
        data: {
            labels: {{ etiquetas_meses | tojson | safe }},
            datasets: [{
                label: 'Citas',
                data: {{ valores_meses | tojson | safe }},
                backgroundColor: '#3498db',
                borderColor: '#2980b9',
                borderWidth: 2
            }]
        },
        options: commonOptions
    });

    // 2. Gr치fico de Pastel
    new Chart(document.getElementById('graficoPastel'), {
        type: 'doughnut',
        data: {
            labels: {{ etiquetas_esp | tojson | safe }},
            datasets: [{
                data: {{ valores_esp | tojson | safe }},
                backgroundColor: ['#e74c3c', '#f1c40f', '#2ecc71', '#9b59b6', '#34495e']
            }]
        },
        options: commonOptions
    });
</script>

<style>
    /* FIX DE EMERGENCIA: Si el CSS original falla, esto lo arregla */
    .kpi-grid { display: flex; gap: 15px; justify-content: space-around; flex-wrap: wrap; margin-bottom: 30px; }
    .kpi-card { padding: 20px; border-radius: 10px; color: white; text-align: center; flex: 1; min-width: 200px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .gold { background: linear-gradient(45deg, #f1c40f, #f39c12); }
    .blue { background: linear-gradient(45deg, #3498db, #2980b9); }
    .green { background: linear-gradient(45deg, #2ecc71, #27ae60); }
    .red { background: linear-gradient(45deg, #e74c3c, #c0392b); }
    
    .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    .chart-container-box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    
    @media (max-width: 768px) {
        .charts-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}